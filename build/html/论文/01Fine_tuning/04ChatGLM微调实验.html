<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
    <meta charset="utf-8" />
        <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>ChatGLMå¾®è°ƒå®éªŒ &mdash; SphinxDiary v1.0 æ–‡æ¡£</title>
    
    <link rel="stylesheet" type="text/css" href="../../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/dist/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
            <link rel="index" title="ç´¢å¼•" href="../../genindex.html" />
            <link rel="search" title="æœç´¢" href="../../search.html" />
            <link rel="top" title="SphinxDiary v1.0 æ–‡æ¡£" href="#" />
            <link rel="up" title="Fine tuning" href="../1-index.html" />
            <link rel="next" title="è¯­éŸ³è¯†åˆ«" href="../2-index.html" />
            <link rel="prev" title="LoRA" href="03Lora.html" />
    </head>
<body>
    <script type="text/javascript" src="../../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../../_static/img/wagtail-logo-new.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        Sphinx Wagtail Theme
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">ç¬”è®°:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/1-index.html">Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/01Docker/01Docker%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7.html">Dockeræ–°å»ºç”¨æˆ·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/01Docker/02Docker%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C.html">DockeråŸºæœ¬æ“ä½œ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/01Docker/03Docker%E5%AE%B9%E5%99%A8%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%81%E7%A7%BB.html">Dockerå®¹å™¨å¤‡ä»½ä¸è¿ç§»</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/2-index.html">Kubernetes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/02Triton_with_kubernetes/01%E5%9C%A8Ubuntu18.04%E4%B8%8A%E6%90%AD%E5%BB%BAkubernetes.html">kuberneteså®‰è£…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/02Triton_with_kubernetes/02%E4%BD%BF%E7%94%A8MIG%E5%92%8CKubernetes%E5%A4%A7%E8%A7%84%E6%A8%A1%E9%83%A8%E7%BD%B2NVIDIA%20Triton.html">Kuberneteséƒ¨ç½²NVIDIA Triton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/02Triton_with_kubernetes/03%E4%BD%BF%E7%94%A8Kubernetes%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4.html">Kubernetesåˆ›å»ºé›†ç¾¤</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/02Triton_with_kubernetes/04Triton%20Metrics.html">Triton Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/02Triton_with_kubernetes/05Grafana.html">Grafana</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/3-index.html">Triton</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/03Triton/01Triton_Inference_Server%E5%85%A5%E9%97%A8.html">Triton Inference Serverå…¥é—¨</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/03Triton/02Triton%E5%85%A5%E9%97%A8%E7%BA%A7%E6%95%99%E7%A8%8B.html">Tritonå…¥é—¨çº§æ•™ç¨‹</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/03Triton/03Triton_Backend%E8%AF%A6%E8%A7%A3.html">Triton_Backendè¯¦è§£</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/4-index.html">Pytorch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/04Pytorch/01%E6%95%B0%E6%8D%AE%E9%9B%86.html">æ•°æ®é›†</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/5-index.html">è¯­éŸ³è¯†åˆ«ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/05%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/01jetpack5.0.2%E5%AE%89%E8%A3%85.html">Jetpack 5.0.2å®‰è£…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/05%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/02%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.html">æ·±åº¦å­¦ä¹ ç¯å¢ƒé…ç½®</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/05%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/03%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2.html">è¯­éŸ³è¯†åˆ«æ¨¡å‹éƒ¨ç½²</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/05%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/04%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86.html">å®¢æˆ·ç«¯æ¨¡å‹æ¨ç†</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/05%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/05%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.html">æ€§èƒ½æµ‹è¯•</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/6-index.html">å°å·¥å…·</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/01Git.html">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/2-index.html">Sphinx</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/02Sphinx/01GitHub%20%2B%20Spinx%20%2B%20Read%20the%20docs%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%EF%BC%88%E4%B8%80%EF%BC%89.html">GitHub + Spinx + Read the docså®æˆ˜å…¥é—¨æŒ‡å—ï¼ˆä¸€ï¼‰</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/02Sphinx/02GitHub%20%2B%20Spinx%20%2B%20Read%20the%20docs%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%EF%BC%88%E4%BA%8C%EF%BC%89.html">GitHub + Spinx + Read the docså®æˆ˜å…¥é—¨æŒ‡å—ï¼ˆäºŒï¼‰</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/02Sphinx/03Markdown.html">Markdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/02Sphinx/04MyST-Parser.html">MyST-Parser</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/03Fastertransformer.html">Fastertransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/04FileBrowser.html">FileBrowser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/05NFS%E9%85%8D%E7%BD%AE.html">NFSé…ç½®</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/06%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7.html">æœåŠ¡å™¨æ–‡ä»¶ç®¡ç†å·¥å…·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/06%E5%B0%8F%E5%B7%A5%E5%85%B7/07StableDiffusion.html">Stable Diffusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/7-index.html">NNI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/07NNI/01-NNI%E7%A4%BA%E4%BE%8B.html">NNI ç¤ºä¾‹</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/07NNI/02-NNI%E9%83%A8%E7%BD%B2.html">NNI éƒ¨ç½²</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/8-index.html">Android</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/08Android/01Android%20APK.html">Android APK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/9-index.html">Android Studio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/09Android%20Studio/01Android%E4%BD%BF%E7%94%A8.html">1.å¯¼å…¥.aaræ–‡ä»¶</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/09Android%20Studio/01Android%E4%BD%BF%E7%94%A8.html#app-build-gradle-dependencies">2.åœ¨app/build.gradle dependenciesä¸­åŠ å…¥ï¼š</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../%E7%AC%94%E8%AE%B0/09Android%20Studio/01Android%E4%BD%BF%E7%94%A8.html#id1">3.é‡æ–°ç¼–è¯‘å·¥ç¨‹</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">è®ºæ–‡:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../1-index.html">Fine tuning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01Prompt%20Tuning.html">Prompt Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="02Prompt%20Tuning%20v2.html">Prompt Tuning V2</a></li>
<li class="toctree-l2"><a class="reference internal" href="03Lora.html">LoRA</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ChatGLMå¾®è°ƒå®éªŒ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2-index.html">è¯­éŸ³è¯†åˆ«</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/1-index.html">è¯­éŸ³è¯†åˆ«ç»¼è¿°</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/01%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%BB%BC%E8%BF%B0/1-Recent%20Advance%20in%20End-to-End%20Automatic%20Speech%20Recognition.html">1-Recent Advance in End-to-End Automatic Speech Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/01%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E7%BB%BC%E8%BF%B0/2-A%20Comparative%20Study%20On%20Transformer%20VS%20RNN%20In%20Speech%20Applications.html">2-A Comparative Study On Transformer VS RNN In Speech Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/2-index.html">Wenet</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/1-WeNet%20Production%20Oriented%20Streaming%20and%20Non-Streaming%20End-to-End%20Speech%20Recognition%20Toolkit.html">1-WeNet Production Oriented Streaming and Non-Streaming End-to-End Speech Recognition Toolkit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/2-WeNet2.0%20More%20Productive%20End-to-End%20Speech%20Recognition%20Toolkit.html">2-Wenet2.0 More Productive End-to-End Speech Recognition Toolkit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/3-WeNet-LM%E6%A8%A1%E5%9E%8B.html">3-WeNet-LMæ¨¡å‹</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/4-WeNet%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84.html">4-Wenetæ¨¡å‹ç»“æ„</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/5-WeNet%E5%AE%9E%E9%AA%8C%E5%B0%8F%E7%BB%93.html">5-WeNetå®éªŒå°ç»“</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/02Wenet/6-WeNet%E9%83%A8%E7%BD%B2.html">6-WeNetéƒ¨ç½²</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/3-index.html">æ¨¡å‹å¾®è°ƒ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/03%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/1-FINE-TUNING%20OF%20PRE-TRAINED%20END-TO-END%20SPEECH%20RECOGNITION%20WITH%20GENERATIVE%20ADVERSARIAL%20NETWORKS.html">1-Fine-Tuning Of Pre-trained end-to-end Speech Recognition With Generative Adversarial Networks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/4-index.html">ç¼–ç å™¨</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/04%E7%BC%96%E7%A0%81%E5%99%A8/1-Conformer-Convolution-augmented%20Transformer%20for%20Speech%20Recognition.html">1-Conformer-Convolution-augmented Transformer for Speech Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/04%E7%BC%96%E7%A0%81%E5%99%A8/2-Paraformer-Fast%20and%20Accurate%20Parallel%20Transformer%20for%20Non-autoregressive.html">2-Paraformer-Fast and Accurate Parallel Transformer for Non-autoregressive</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/04%E7%BC%96%E7%A0%81%E5%99%A8/3-LFEformer-Local_Feature_Enhancement_Using_Sliding_Window_With_Deformability_for_Automatic_Speech_Recognition.html">3-LFEformer-Local Feature Enhancement Using Sliding Window With Deformability for Automatic Speech Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/04%E7%BC%96%E7%A0%81%E5%99%A8/4-Squeezeformer-An%20Efficient%20Transformer%20for%20Automatic%20Speech%20Recognition.html">4-Squeezeformer-An Efficient Transformer for Automatic Speech Recognition</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3-index.html">è”é‚¦å­¦ä¹ </a><ul>
<li class="toctree-l2"><a class="reference internal" href="../03%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/1-index.html">è”é‚¦å­¦ä¹ é¡¹ç›®</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../03%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/01%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE/1-%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE.html">è”é‚¦å­¦ä¹ å¼€æºé¡¹ç›®</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4-index.html">è¯­è¨€æ¨¡å‹</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../04%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/1-Transformer-XL-Attention%20Language%20Models%20Beyond%20a%20Fixed-Length%20Context.html">1-Transformer-XL-Attention Language Models Beyond a Fixed-Length Context</a></li>
</ul>
</li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../../index.html">Docs</a></li>
            <li class="breadcrumb-item"><a href="../1-index.html">Fine tuning</a></li>
        <li class="breadcrumb-item active" aria-current="page">ChatGLMå¾®è°ƒå®éªŒ</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/wagtail/sphinx_wagtail_theme/blob/main/docs/è®ºæ–‡/01Fine_tuning/04ChatGLMå¾®è°ƒå®éªŒ.md" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="../../_sources/è®ºæ–‡/01Fine_tuning/04ChatGLMå¾®è°ƒå®éªŒ.md.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section class="tex2jax_ignore mathjax_ignore" id="chatglm">
<h1>ChatGLMå¾®è°ƒå®éªŒ<a class="headerlink" href="#chatglm" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<p>å¾®è°ƒå®éªŒå‚è€ƒé“¾æ¥ï¼š<a class="reference external" href="https://github.com/liucongg/ChatGLM-Finetuning">https://github.com/liucongg/ChatGLM-Finetuning</a></p>
<p><strong>é¢„è®­ç»ƒAIå¤§æ¨¡å‹</strong></p>
<p>AIé¢„è®­ç»ƒå¤§æ¨¡å‹ç½‘å€ï¼š<a class="reference external" href="https://www.datalearner.com/ai-models/pretrained-models">æœ€è¿‘å‡ å¹´AIæ¨¡å‹åˆ—è¡¨</a></p>
<p><img alt="" src="../../_images/image-20230509163925799.png" /></p>
<p>AIæ¨¡å‹æœˆæŠ¥</p>
<p><img alt="" src="../../_images/image-20230509164042167.png" /></p>
<p>AIå¤§æ¨¡å‹é¢„è§ˆå›¾ï¼š</p>
<p><img alt="" src="../../_images/1.png" /></p>
<p><strong>ChatGLM-6Bæ¨¡å‹ç»“æ„</strong></p>
<p>â€‹	ChatGLM-6Bçš„åº•å±‚æ¶æ„æ˜¯é€šç”¨è¯­è¨€æ¨¡å‹ï¼ˆGLMï¼‰ï¼ŒGLMåˆ©ç”¨è‡ªå›å½’ç©ºç™½å¡«å……ä½œä¸ºå…¶ä¸»è¦çš„é¢„è®­ç»ƒç›®æ ‡ï¼Œå®ƒæ©ç›–äº†éšæœºçš„è¿ç»­æ–‡æœ¬åŒºé—´ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè‡ªå›å½’é¢„æµ‹ï¼Œé‡‡ç”¨ä¸¤ç§ä¸åŒçš„æ©ç æ ‡è¯†ç¬¦[MASK]å’Œ[gMASK]åˆ†åˆ«ç”¨äºçŸ­æ–‡å’Œé•¿æ–‡çš„ç”Ÿæˆ</p>
<p><img alt="" src="../../_images/image-20230509170917122.png" /></p>
<p>â€‹	ChatGLM-6Bæ˜¯æ¸…åå¤§å­¦çŸ¥è¯†å·¥ç¨‹å’Œæ•°æ®æŒ–æ˜å°ç»„å‘å¸ƒçš„ä¸€ä¸ªå¼€æºçš„å¯¹è¯æœºå™¨äººï¼Œçº¦60äº¿å‚æ•°çš„ä¸­è‹±æ–‡è¯­è¨€æ¨¡å‹ï¼Œå¹¶å¯¹ä¸­æ–‡åšäº†ä¼˜åŒ–ã€‚</p>
<ul class="simple">
<li><p>28å±‚Transformerï¼Œé‡‡ç”¨<code class="docutils literal notranslate"><span class="pre">final_layernorm</span></code>è¿›è¡Œè¾“å‡º</p></li>
<li><p>æ¯ä¸€å±‚çš„ç»“æ„ï¼š<code class="docutils literal notranslate"><span class="pre">input_layernorm</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">attention.query_key_value</span></code> -&gt;<code class="docutils literal notranslate"><span class="pre">attention.dense</span></code>-&gt; <code class="docutils literal notranslate"><span class="pre">post_attention_layernorm</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">mlp.dense_h_to_4h</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">mlp.dense_4h_to_h</span></code></p></li>
<li><p>æ€»å…±å‚æ•°6173286400</p></li>
</ul>
<p><strong>å¤šå¡éƒ¨ç½²</strong></p>
<p>å¦‚æœä½ æœ‰å¤šå¼  GPUï¼Œä½†æ˜¯æ¯å¼  GPU çš„æ˜¾å­˜å¤§å°éƒ½ä¸è¶³ä»¥å®¹çº³å®Œæ•´çš„æ¨¡å‹ï¼Œé‚£ä¹ˆå¯ä»¥å°†æ¨¡å‹åˆ‡åˆ†åœ¨å¤šå¼ GPUä¸Šã€‚é¦–å…ˆå®‰è£… accelerate: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">accelerate</span></code>ï¼Œç„¶åé€šè¿‡å¦‚ä¸‹æ–¹æ³•åŠ è½½æ¨¡å‹ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">load_model_on_gpus</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">load_model_on_gpus</span><span class="p">(</span><span class="s2">&quot;../chatglm-6b&quot;</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>å³å¯å°†æ¨¡å‹éƒ¨ç½²åˆ°ä¸¤å¼  GPU ä¸Šè¿›è¡Œæ¨ç†ã€‚</p>
<p>å•å¡éƒ¨ç½²æ˜¾å­˜å ç”¨ï¼š</p>
<p><img alt="" src="../../_images/image-20230509201910217.png" /></p>
<p>å¤šå¡éƒ¨ç½²æ˜¾å­˜å ç”¨ï¼š</p>
<p><img alt="" src="../../_images/image-20230509201720223.png" /></p>
<p>åœ¨å¤šå¡éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¿›è¡Œæ¨ç†ï¼Œä½†æ— æ³•è¿›è¡Œè®­ç»ƒï¼Œä¼šå‡ºç°é”™è¯¯ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:1 and cuda:0! (when checking argument for argument weight in method wrapper__native_layer_norm)
</pre></div>
</div>
<p><strong>æ¨¡å‹éƒ¨ç½²</strong></p>
<ul>
<li><p>ä»£ç è°ƒç”¨ç”Ÿæˆå¯¹è¯</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span><span class="p">,</span> <span class="n">AutoModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;../chatglm-6b&quot;</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;../chatglm-6b&quot;</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">half</span><span class="p">()</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">,</span> <span class="s2">&quot;ä½ å¥½&quot;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="go">ä½ å¥½ğŸ‘‹!æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM-6B,å¾ˆé«˜å…´è§åˆ°ä½ ,æ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">,</span> <span class="s2">&quot;æ™šä¸Šç¡ä¸ç€åº”è¯¥æ€ä¹ˆåŠ&quot;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="go">æ™šä¸Šç¡ä¸ç€å¯èƒ½ä¼šè®©äººæ„Ÿåˆ°å›°æ‰°å’Œç„¦è™‘ï¼Œä½†æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ å…¥ç¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½æœ‰ç”¨çš„æŠ€å·§ï¼š</span>

<span class="go">1. åˆ›é€ ä¸€ä¸ªèˆ’é€‚çš„ç¡çœ ç¯å¢ƒï¼šç¡®ä¿å§å®¤å®‰é™ã€é»‘æš—ã€å‡‰çˆ½å’Œèˆ’é€‚ã€‚ä½ å¯ä»¥ä½¿ç”¨æŸ”å’Œçš„éŸ³ä¹æˆ–ç™½å™ªå£°ã€çª—å¸˜æˆ–çœ¼ç½©æ¥å¸®åŠ©åˆ›é€ èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚</span>

<span class="go">2. å»ºç«‹ä¸€ä¸ªç¡å‰ä¾‹è¡Œç¨‹åºï¼šæ¯å¤©æ™šä¸Šåœ¨ç›¸åŒçš„æ—¶é—´ä¸ŠåºŠï¼Œå¹¶å»ºç«‹ä¸€ä¸ªç¡å‰ä¾‹è¡Œç¨‹åºï¼Œå¦‚æ´—æ¾¡ã€è¯»ä¹¦æˆ–å¬è½»æŸ”çš„éŸ³ä¹ï¼Œæœ‰åŠ©äºè®©èº«ä½“å’Œå¤§è„‘å‡†å¤‡å¥½ç¡è§‰ã€‚</span>

<span class="go">3. é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼šåœ¨ç¡è§‰å‰å°½é‡é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼Œå¦‚æ‰‹æœºã€ç”µè„‘å’Œç”µè§†ï¼Œå› ä¸ºè¿™äº›è®¾å¤‡ä¼šå‘å‡ºè“å…‰ï¼Œå½±å“èº«ä½“é‡Šæ”¾è¤ªé»‘ç´ ï¼Œè¿™æ˜¯å¸®åŠ©å…¥ç¡çš„å…³é”®ç‰©è´¨ã€‚</span>

<span class="go">4. å°è¯•æ”¾æ¾æŠ€å·§ï¼šæ”¾æ¾æŠ€å·§ï¼Œå¦‚æ·±å‘¼å¸ã€æ¸è¿›æ€§è‚Œè‚‰æ¾å¼›å’Œå†¥æƒ³ï¼Œå¯ä»¥å¸®åŠ©ä½ æ”¾æ¾èº«ä½“å’Œå¤´è„‘ï¼Œæ›´å®¹æ˜“å…¥ç¡ã€‚</span>

<span class="go">5. é¿å…åœ¨åºŠä¸Šåšå…¶ä»–äº‹æƒ…ï¼šé¿å…åœ¨åºŠä¸Šåšä¸ç¡çœ æ— å…³çš„äº‹æƒ…ï¼Œå¦‚çœ‹ç”µè§†ã€ä½¿ç”¨ç”µè„‘æˆ–æ‰‹æœºç­‰ï¼Œè¿™å°†æœ‰åŠ©äºç¡®ä¿èº«ä½“å’Œå¤§è„‘è¿›å…¥ç¡çœ çŠ¶æ€ã€‚</span>

<span class="go">å¦‚æœä½¿ç”¨äº†è¿™äº›æ–¹æ³•ä»ç„¶æ— æ³•å…¥ç¡ï¼Œä½ å¯èƒ½éœ€è¦å¯»æ±‚åŒ»ç”Ÿçš„å»ºè®®ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨æŸäº›ç¡çœ éšœç¢æˆ–å…¶ä»–å¥åº·é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ²»ç–—ã€‚</span>
</pre></div>
</div>
</li>
<li><p>ç½‘é¡µç‰ˆDemo</p></li>
<li><p>å‘½ä»¤è¡ŒDemo</p>
<p><img alt="" src="../../_images/image-20230510201219981.png" /></p>
</li>
</ul>
<p><strong>ä¸‰å…ƒç»„æŠ½å–ä»»åŠ¡</strong></p>
<ul class="simple">
<li><p>é‡‡ç”¨ä¸€ä¸ªé¢†åŸŸçš„æ¯”èµ›æ•°æ®é›†-<a class="reference external" href="https://www.datafountain.cn/competitions/584">æ±½è½¦å·¥ä¸šæ•…éšœæ¨¡å¼å…³ç³»æŠ½å–</a>ï¼ŒéšæœºæŠ½å–50æ¡ä½œä¸ºæµ‹è¯•é›†</p></li>
<li><p>æœ¬ä»»åŠ¡ä¸ºä¿¡æ¯æŠ½å–ä¸­çš„å…³ç³»æŠ½å–ä»»åŠ¡ï¼Œå¸¦æŠ½å–çš„æ–‡æœ¬è¯­æ–™ä¸ºå·¥ä¸šåˆ¶é€ é¢†åŸŸç›¸å…³æ•…éšœæ¡ˆä¾‹æ–‡æœ¬</p></li>
<li><p>éƒ¨ä»¶å•å…ƒï¼ˆç‡ƒæ²¹æ³µã€æ¢æµå˜å‹å™¨ã€åˆ†ç¦»å™¨ï¼‰ã€æ€§èƒ½è¡¨å¾ï¼ˆå‹åŠ›ã€è½¬é€Ÿã€æ¸©åº¦ï¼‰ã€æ•…éšœçŠ¶æ€ï¼ˆæ¼æ²¹ã€æ–­è£‚ã€å˜å½¢ã€å¡æ»ï¼‰</p></li>
</ul>
<p>æœªå¾®è°ƒï¼š</p>
<p><img alt="" src="../../_images/image-20230425200038369.png" /></p>
<p>ç†æƒ³ç­”æ¡ˆï¼š</p>
<p><img alt="" src="../../_images/image-20230425200015879.png" /></p>
<p><strong>Freezeæ–¹æ³•</strong></p>
<p>â€‹	Freezeæ–¹æ³•ï¼Œå³å‚æ•°å†»ç»“ï¼Œå¯¹åŸå§‹æ¨¡å‹éƒ¨åˆ†å‚æ•°è¿›è¡Œå†»ç»“æ“ä½œï¼Œä»…è®­ç»ƒéƒ¨åˆ†å‚æ•°ï¼Œä»¥è¾¾åˆ°åœ¨å•å¡æˆ–ä¸è¿›è¡ŒTPæˆ–PPæ“ä½œï¼Œå°±å¯ä»¥å¯¹å¤§æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><img alt="" src="../../_images/image-20230509171421842.png" /></p>
<p>è®­ç»ƒé‡‡ç”¨<a class="reference external" href="https://www.deepspeed.ai/">DeepSpeed</a>è¿›è¡Œè®­ç»ƒã€‚deep speedæ˜¯å¾®è½¯çš„æ–°å¤§è§„æ¨¡æ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒçš„å·¥å…·ï¼Œä¸“é—¨ä¸ºè®­ç»ƒè¶…å¤§æ¨¡å‹è€Œç”Ÿï¼Œå·ç§°å¯ä»¥è®­ç»ƒ10Bå‚æ•°çš„æ¨¡å‹ï¼Œæ¯”ç›®å‰æœ€å¥½çš„æ¨¡å‹å¤§10å€ï¼Œè®­ç»ƒé€Ÿåº¦å—10å€ï¼Œå…¼å®¹pytorchçš„æ¨¡å‹ï¼Œæ”¹åŠ¨æœ€å°‘ä»£ç ã€‚</p>
<ul class="simple">
<li><p>æ¨¡å‹è®­ç»ƒæ—¶ï¼Œæœ€å¤§é•¿åº¦ä¸º768ï¼ŒBatch sizeä¸º2ï¼Œè®­ç»ƒè½®æ•°ä¸º5ï¼Œfp16è®­ç»ƒï¼Œä»…è®­ç»ƒæ¨¡å‹çš„å5å±‚å‚æ•°</p></li>
<li><p>è®­ç»ƒç¤ºä¾‹</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>prompt_text = ä½ ç°åœ¨æ˜¯ä¸€ä¸ªä¿¡æ¯æŠ½å–æ¨¡å‹ï¼Œè¯·ä½ å¸®æˆ‘æŠ½å–å‡ºå…³ç³»å†…å®¹ä¸º\&quot;æ€§èƒ½æ•…éšœ\&quot;, \&quot;éƒ¨ä»¶æ•…éšœ\&quot;, \&quot;ç»„æˆ\&quot;å’Œ \&quot;æ£€æµ‹å·¥å…·\&quot;çš„ç›¸å…³ä¸‰å…ƒç»„ï¼Œä¸‰å…ƒç»„å†…éƒ¨ç”¨\&quot;_\&quot;è¿æ¥ï¼Œä¸‰å…ƒç»„ä¹‹é—´ç”¨\\nåˆ†å‰²ã€‚æ–‡æœ¬ï¼š
è¾“å…¥ï¼š332å·æ±½è½¦æ•…éšœæŠ¥å‘Šæ•…éšœç°è±¡ç©ºè°ƒç³»ç»Ÿæ•…éšœï¼ŒæŒ‰ç©ºè°ƒæ§åˆ¶å™¨ä»»ä½•æŒ‰é”®éƒ½æ²¡æœ‰åæ˜ ã€‚
è¾“å‡ºï¼šç©ºè°ƒç³»ç»Ÿ_éƒ¨ä»¶æ•…éšœ_æ•…éšœ\nç©ºè°ƒæ§åˆ¶å™¨_éƒ¨ä»¶æ•…éšœ_æ²¡æœ‰åæ˜ 
</pre></div>
</div>
<p>å•å¡è®­ç»ƒè„šæœ¬ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">chatglm</span>

<span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span> <span class="n">deepspeed</span> <span class="n">finetuning_freeze</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">num_train_epochs</span> <span class="mi">5</span> <span class="o">--</span><span class="n">train_batch_size</span> <span class="mi">2</span>
</pre></div>
</div>
<p>å¤šå¡è®­ç»ƒè„šæœ¬ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span> <span class="n">deepspeed</span> <span class="n">finetuning_freeze</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">num_train_epochs</span> <span class="mi">5</span> <span class="o">--</span><span class="n">train_batch_size</span> <span class="mi">2</span>
</pre></div>
</div>
<p>åœ¨å¤šå¡æ¨¡å¼ä¸‹ï¼Œè®­ç»ƒæ˜¾å­˜ç¿»å€å¢åŠ ï¼Œè®­ç»ƒæ—¶é—´å˜æ…¢å¾ˆå¤šï¼Ÿï¼Ÿï¼Ÿ</p>
<p><strong>P-tuning V2æ–¹æ³•</strong></p>
<p>â€‹	æ˜¯ä¸€ç§é’ˆå¯¹å¤§æ¨¡å‹çš„soft-promptæ–¹æ³•ï¼ŒP-tuning V2å°†å¤§æ¨¡å‹çš„Embeddingå’Œæ¯ä¸€å±‚å‰åŠ å…¥æ–°çš„Promptå‚æ•°ï¼Œæ ¸å¿ƒä»£ç ï¼š</p>
<p><img alt="" src="../../_images/image-20230509173739968.png" /></p>
<p>å½“<code class="docutils literal notranslate"><span class="pre">prefix_encoder</span></code>ä¸ºTrueæ—¶ï¼Œé‡‡ç”¨<code class="docutils literal notranslate"><span class="pre">P-Tuning</span> <span class="pre">V2</span></code>æ–¹æ³•ï¼›ä¸º<code class="docutils literal notranslate"><span class="pre">False</span></code>æ—¶ï¼Œé‡‡ç”¨<code class="docutils literal notranslate"><span class="pre">P-Tuning</span></code>æ–¹æ³•ï¼Œä»…åœ¨å¤§æ¨¡å‹çš„Embeddingä¸Šæ·»åŠ å‚æ•°</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="mi">0</span> <span class="n">deepspeed</span> <span class="n">finetuning_pt</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">num_train_epochs</span> <span class="mi">5</span> <span class="o">--</span><span class="n">train_batch_size</span> <span class="mi">2</span> <span class="o">--</span><span class="n">pre_seq_len</span> <span class="mi">16</span>
</pre></div>
</div>
<p><strong>LoRAæ–¹æ³•</strong></p>
<p>Loraæ–¹æ³•ï¼Œå³åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸Šå¯¹æŒ‡å®šå‚æ•°ï¼ˆæƒé‡çŸ©é˜µï¼‰å¹¶è¡Œå¢åŠ é¢å¤–çš„ä½ç§©çŸ©é˜µï¼Œå¹¶åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä»…è®­ç»ƒé¢å¤–å¢åŠ çš„å¹¶è¡Œä½ç§©çŸ©é˜µçš„å‚æ•°ã€‚ å½“â€œç§©å€¼â€è¿œå°äºåŸå§‹å‚æ•°ç»´åº¦æ—¶ï¼Œæ–°å¢çš„ä½ç§©çŸ©é˜µå‚æ•°é‡ä¹Ÿå°±å¾ˆå°ã€‚åœ¨ä¸‹æ¸¸ä»»åŠ¡tuningæ—¶ï¼Œä»…é¡»è®­ç»ƒå¾ˆå°çš„å‚æ•°ï¼Œä½†èƒ½è·å–è¾ƒå¥½çš„è¡¨ç°ç»“æœã€‚æ ¸å¿ƒä»£ç ï¼š</p>
<p><img alt="" src="../../_images/image-20230511203445674.png" /></p>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>å¾®è°ƒæ–¹æ³•</p></th>
<th class="head"><p>æœªå¾®è°ƒ</p></th>
<th class="head"><p>Freeze(fp16)</p></th>
<th class="head"><p>PT(int 4)</p></th>
<th class="head"><p>LoRA(load_in_int8)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>è®­ç»ƒæ˜¾å­˜å ç”¨</p></td>
<td><p></p></td>
<td><p>22.938GiB</p></td>
<td><p>21.894GiB</p></td>
<td><p>22.662GiB</p></td>
</tr>
<tr class="row-odd"><td><p>å¯è®­ç»ƒå‚æ•°</p></td>
<td><p></p></td>
<td><p>1.01B</p></td>
<td><p>0.96B</p></td>
<td><p>0.0367B</p></td>
</tr>
<tr class="row-even"><td><p>æ€»å‚æ•°</p></td>
<td><p></p></td>
<td><p>6.17B</p></td>
<td><p>4.31B</p></td>
<td><p>6.17B</p></td>
</tr>
<tr class="row-odd"><td><p>å¯è®­ç»ƒå‚æ•°æ¯”</p></td>
<td><p></p></td>
<td><p>16.31%</p></td>
<td><p>22.18%</p></td>
<td><p>0.06%</p></td>
</tr>
<tr class="row-even"><td><p>æ¨ç†æ˜¾å­˜å ç”¨</p></td>
<td><p></p></td>
<td><p>13.174GiB</p></td>
<td><p>7.788GiB</p></td>
<td><p>9.184GiB</p></td>
</tr>
<tr class="row-odd"><td><p>è®­ç»ƒè€—æ—¶</p></td>
<td><p></p></td>
<td><p>78.86min</p></td>
<td><p>107.6min</p></td>
<td><p>73.5min</p></td>
</tr>
<tr class="row-even"><td><p>æµ‹è¯•ç»“æœF1</p></td>
<td><p>0.0</p></td>
<td><p>0.5467</p></td>
<td><p>0.6211</p></td>
<td><p>0.5393</p></td>
</tr>
<tr class="row-odd"><td><p>æµ‹è¯•è€—æ—¶</p></td>
<td><p>113.215s</p></td>
<td><p>44.161s</p></td>
<td><p>96.128s</p></td>
<td><p>172.885s</p></td>
</tr>
</tbody>
</table>
<p><strong>é‡åˆ°çš„é—®é¢˜</strong></p>
<ul class="simple">
<li><p>bitsandbytes</p></li>
</ul>
<p>åœ¨æ¨¡å‹åŠ è½½ä¸­ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">load_in_8bit=True</span></code>æ—¶ï¼Œè¦æ±‚å®‰è£…accelerateå’Œbitsandbytes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ChatGLMForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">load_in_8bit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device_map</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>å¯¹äºCUDA11.8ï¼Œaccelerateä½¿ç”¨pipè¿›è¡Œå®‰è£…ï¼Œç›´æ¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">bitsandbytes</span></code>å®‰è£…åªèƒ½å®‰è£…åˆ°cu117ç‰ˆæœ¬ï¼Œéœ€è¦é‡‡ç”¨æºç å®‰è£…ï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">timdettmers</span><span class="o">/</span><span class="n">bitsandbytes</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">bitsandbytes</span>

<span class="c1"># CUDA_VERSIONS in {110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 120}</span>
<span class="c1"># make argument in {cuda110, cuda11x, cuda12x}</span>
<span class="c1"># if you do not know what CUDA you have, try looking at the output of: python -m bitsandbytes</span>
<span class="n">CUDA_VERSION</span><span class="o">=</span><span class="mi">117</span> <span class="n">make</span> <span class="n">cuda11x</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
<ul>
<li><p>è®­ç»ƒLoRAæ—¶ï¼Œéšç€è®­ç»ƒè½®æ¬¡çš„å¢åŠ ï¼Œæ˜¾å­˜å ç”¨ä¹Ÿä¼šå¢åŠ ï¼Œå®¹æ˜“çˆ†æ˜¾å­˜ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯ä»¥æœ‰æ‰€ç¼“è§£</p>
<ol class="arabic">
<li><p>è®¾ç½®<code class="docutils literal notranslate"><span class="pre">max_split_size_mb:128</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTORCH_CUDA_ALLOC_CONF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;max_split_size_mb:128&quot;</span>
</pre></div>
</div>
</li>
<li><p>deepspeedåœ¨<code class="docutils literal notranslate"><span class="pre">zero_optimization</span></code>ä¸‹æ·»åŠ è®¾ç½®</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;offload_param&quot;</span><span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
	<span class="s2">&quot;pin_memory&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">},</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="03Lora.html" title="Previous">
        <span aria-hidden="true">â†&nbsp;</span>LoRA
    </a>
    <a class="float-right" href="../2-index.html" title="Next">
        è¯­éŸ³è¯†åˆ« <span aria-hidden="true">&nbsp;â†’</span>
    </a>
</nav>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/features/">Features</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/about-wagtail/"> About Wagtail</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/services/"> Services</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/blog/"> Blog</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/packages/"> Packages</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/developers/"> Developers</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                <p style="display: none">
                    <a class="text-light" href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Wagtail Sphinx Theme 6.0.0
                    </a>
                </p>
            </div>
            <div class="text-center">
                    &copy; Copyright 2023, æä»²äº®
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/translations.js"></script>
        <script type="text/javascript" src="../../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../../_static/searchtools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>